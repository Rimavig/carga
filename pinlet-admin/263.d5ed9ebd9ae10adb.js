"use strict";(self.webpackChunkngx_admin_demo=self.webpackChunkngx_admin_demo||[]).push([[263],{6494:(O,x,c)=>{c.d(x,{P:()=>b});var d=c(24006),p=c(36517),e=c(30551),g=c(12368),h=c(18328),C=c(36895);function P(a,l){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",6)(2,"div",13)(3,"div",14)(4,"span"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(6,"div",13)(7,"div",14)(8,"span"),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(10,"div",13)(11,"div",14)(12,"span"),e.\u0275\u0275text(13),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(14,"div",13)(15,"div",14)(16,"span"),e.\u0275\u0275text(17),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"div",13)(19,"div",14)(20,"span"),e.\u0275\u0275text(21),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(22,"div",13)(23,"div",14)(24,"span"),e.\u0275\u0275text(25),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(26,"div",6)(27,"div",15)(28,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const n=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(n.editMode=!0)}),e.\u0275\u0275text(29,"Editar"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd()}if(2&a){const i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1("Nombres: ",i.resident.nombres,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("Apellidos: ",i.resident.apellidos,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("C\xe9dula: ",i.resident.cedula,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("Correo: ",i.resident.correo,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("Celular: ",i.resident.celular,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("Descripci\xf3n: ",i.resident.descripcion,"")}}const v=function(){return{standalone:!0}};function s(a,l){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"form",16)(2,"div",6)(3,"div",13)(4,"div",17)(5,"label",18),e.\u0275\u0275text(6,"Nombres"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"input",19),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"div",13)(9,"div",17)(10,"label",20),e.\u0275\u0275text(11,"Apellidos"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(12,"input",21),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",13)(14,"div",17)(15,"label",22),e.\u0275\u0275text(16,"C\xe9dula"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(17,"input",23),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",13)(19,"div",17)(20,"label",24),e.\u0275\u0275text(21,"Correo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(22,"input",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(23,"div",13)(24,"div",17)(25,"label",26),e.\u0275\u0275text(26,"Sexo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"nb-select",27)(28,"nb-option",28),e.\u0275\u0275text(29,"Seleccionar opci\xf3n"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"nb-option",29),e.\u0275\u0275text(31,"FEMENINO"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"nb-option",30),e.\u0275\u0275text(33,"MASCULINO"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(34,"div",13)(35,"div",17)(36,"label",31),e.\u0275\u0275text(37,"Fecha de nacimiento"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"input",32),e.\u0275\u0275listener("ngModelChange",function(n){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.birthDate=n)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"nb-datepicker",33,34),e.\u0275\u0275listener("dateChange",function(n){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.onDateChanged(n))}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(41,"div",13)(42,"div",17)(43,"label",35),e.\u0275\u0275text(44,"Nacionalidad"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(45,"input",36),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(46,"div",6)(47,"div",37)(48,"button",38),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const n=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(n.editMode=!1)}),e.\u0275\u0275text(49,"Cancelar"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(50,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const n=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(n.updateResident())}),e.\u0275\u0275text(51,"Actualizar"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd()}if(2&a){const i=e.\u0275\u0275reference(40),t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",t.residentForm),e.\u0275\u0275advance(37),e.\u0275\u0275property("ngModel",t.birthDate)("ngModelOptions",e.\u0275\u0275pureFunction0(4,v))("nbDatepicker",i)}}function E(a,l){if(1&a&&(e.\u0275\u0275elementStart(0,"nb-tab",11),e.\u0275\u0275template(1,P,30,6,"ng-container",12),e.\u0275\u0275template(2,s,52,5,"ng-container",12),e.\u0275\u0275elementEnd()),2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!i.editMode),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.editMode)}}function y(a,l){if(1&a&&(e.\u0275\u0275elementStart(0,"nb-option",48),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=l.$implicit;e.\u0275\u0275property("value",i.id_primario),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",i.nombre_primario," ")}}function I(a,l){if(1&a&&(e.\u0275\u0275elementStart(0,"nb-option",48),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const i=l.$implicit;e.\u0275\u0275property("value",i.id_secundario),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",i.nombre_secundario," ")}}function S(a,l){1&a&&(e.\u0275\u0275elementStart(0,"div",6)(1,"div",37)(2,"div",17)(3,"label",24),e.\u0275\u0275text(4,"Correo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"textarea",49),e.\u0275\u0275elementEnd()()())}function T(a,l){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"nb-tab",39)(1,"form",16)(2,"div",6)(3,"div",13)(4,"div",17)(5,"label",40),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"nb-select",41),e.\u0275\u0275listener("selectedChange",function(n){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.onPrimarioChange(n))})("ngModelChange",function(n){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.selectedPrimario=n)}),e.\u0275\u0275template(8,y,2,2,"nb-option",42),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div",13)(10,"div",17)(11,"label",43),e.\u0275\u0275text(12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"nb-select",44),e.\u0275\u0275template(14,I,2,2,"nb-option",42),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275template(15,S,6,0,"div",45),e.\u0275\u0275elementStart(16,"div",6)(17,"div",37)(18,"div",17)(19,"label",46),e.\u0275\u0275text(20,"Descripci\xf3n"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(21,"textarea",47),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(22,"div",6)(23,"div",37)(24,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(i);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.updateResidentPlace())}),e.\u0275\u0275text(25,"Actualizar"),e.\u0275\u0275elementEnd()()()()()}if(2&a){const i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",i.residenceForm),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(i.primario),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngModel",i.selectedPrimario)("ngModelOptions",e.\u0275\u0275pureFunction0(8,v)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",i.primarioList),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(i.secundario),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",i.secundarioList),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.dominio)}}function M(a,l){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",50)(1,"nb-checkbox",53),e.\u0275\u0275listener("checkedChange",function(n){const o=e.\u0275\u0275restoreView(i).$implicit,u=e.\u0275\u0275nextContext(3).$implicit,R=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(R.addOrRemovePermission(n,u.id_permiso,o.id_permiso))}),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()}if(2&a){const i=l.$implicit,t=e.\u0275\u0275nextContext(3).$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("checked","A"===i.estado)("disabled",!n.selectedPermissions.includes(t.id_permiso)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",i.nombre," ")}}function m(a,l){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,M,3,3,"div",52),e.\u0275\u0275elementContainerEnd()),2&a){const i=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",i.dependientes)}}function f(a,l){if(1&a){const i=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",50)(2,"nb-checkbox",51),e.\u0275\u0275listener("checkedChange",function(n){e.\u0275\u0275restoreView(i);const r=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.addOrRemovePermission(n,r.id_permiso))}),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,m,2,1,"ng-container",12),e.\u0275\u0275elementContainerEnd()}if(2&a){const i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275property("checked","A"===i.estado),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(i.permiso),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.dependientes.length>0)}}function _(a,l){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,f,5,3,"ng-container",12),e.\u0275\u0275elementContainerEnd()),2&a){const i=l.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","E"!==i.estado)}}let b=(()=>{class a{constructor(i,t,n,r,o){this._formBuilder=i,this._placeService=t,this._residentService=n,this._toastrService=r,this._dialogService=o,this.onlyPermissions=!1,this.editMode=!1,this.isLoading=!1,this.primarioList=[],this.secundarioList=[],this.permissionList=[],this.selectedPermissions=[],this.dominio=!1,this.initResidentForm(),this.initResidenceForm(),this.dominio=!!this._placeService.place$.dominio}ngOnInit(){this.getResident(this.resident.id_residente),this.getPrimario(),this.getSecundario(this.resident.id_primario),this.selectedPrimario=this.resident.id_primario,this.residentForm.patchValue(this.resident),this.residenceForm.patchValue({id_secundario:this.resident.id_secundario,descripcion:this.resident.descripcion}),this.getPermissions()}initResidentForm(){this.residentForm=this._formBuilder.group({id_residente:["",d.kI.required],nombres:["",d.kI.required],apellidos:["",d.kI.required],correo:["",d.kI.required],cedula:["",d.kI.required],celular:["",d.kI.required],sexo:["",d.kI.required],fecha_nacimiento:["",d.kI.required],nacionalidad:["",d.kI.required],usuario_modificacion:["admin",d.kI.required]})}initResidenceForm(){this.residenceForm=this._formBuilder.group({id_secundario:["",d.kI.required],descripcion:["",d.kI.required],correo:[""],usuario_modificacion:["admin",d.kI.required]})}getResident(i){this._residentService.getResidente({id_residente:i}).subscribe({next:n=>{this.residenceForm.patchValue(n),this.residentForm.patchValue({sexo:n.sexo,nacionalidad:n.nacionalidad,fecha_nacimiento:n.fecha_nacimiento}),n.fecha_nacimiento&&(this.birthDate=this.getDate(n.fecha_nacimiento))},error:()=>{this.showToast("danger","Ha ocurrido un error al cargar el residente")}})}getDate(i){const t=i.split("-"),n=parseInt(t[0]),r=parseInt(t[1]),o=parseInt(t[2]);return new Date(n,r-1,o)}onDateChanged(i){this.residentForm.patchValue({fecha_nacimiento:i.toISOString().substring(0,10)})}getPrimario(){this._placeService.getPrimarios({id_usuario:1,id_lugar:this.resident.id_lugar}).subscribe({next:t=>{this.primarioList=t}})}getSecundario(i){this._placeService.getSecundarios({id_usuario:1,id_primario:i}).subscribe({next:n=>{this.secundarioList=n}})}onPrimarioChange(i){this.residenceForm.patchValue({id_secundario:null}),this.getSecundario(i)}updateResident(){this._residentService.updateResidente(this.residentForm.value).subscribe({next:()=>{this.showToast("success","Residente actualizado")},error:()=>{this.showToast("danger","Error al actualizar")}})}updateResidentPlace(){const{correo:i,...t}=this.residenceForm.value,n={id_residente_lugar:this.resident.id_residente_lugar,id_residente:this.resident.id_residente,...t};this.dominio&&(n.correo=i),this._residentService.updateResidenteLugar(n).subscribe({next:()=>{this.showToast("success","Residencia actualizada")},error:()=>{this.showToast("danger","Error al actualizar")}})}getPermissions(){this.isLoading=!0,this._residentService.getPermissions({id_residente_lugar:this.resident.id_residente_lugar,id_lugar:this.resident.id_lugar}).subscribe({next:t=>{this.permissionList=t,this.permissionList.map(n=>{"A"==n.estado&&(this.selectedPermissions.push(n.id_permiso),n.dependientes?.map(r=>{"A"==r.estado&&this.selectedPermissions.push(r.id_permiso)}))}),this.isLoading=!1}})}addOrRemovePermission(i,t,n){const r=i?"A":"I";this.permissionList=this.permissionList.map(o=>(o.id_permiso==t&&(n?(i?this.selectedPermissions.push(n):this.selectedPermissions=this.selectedPermissions.filter(u=>u!=n),o.dependientes=o.dependientes.map(u=>(u.id_permiso==n&&(u.estado=r),u))):(i?this.selectedPermissions.push(t):(this.selectedPermissions=this.selectedPermissions.filter(u=>u!=o.id_permiso),o.dependientes=o.dependientes.map(u=>(this.selectedPermissions=this.selectedPermissions.filter(R=>R!=u.id_permiso),u.estado=r,u))),o.estado=r)),o))}updatePermissions(){const i={id_residente_lugar:this.resident.id_residente_lugar,lista:this.selectedPermissions.sort((t,n)=>t-n),usuario_modificacion:"admin"};this._residentService.updatePermissions(i).subscribe({next:()=>{this.onlyPermissions?this._dialogService.close(!0):this.showToast("success","Permisos actualizados")},error:()=>{this.showToast("danger","Error al actualizar")}})}showToast(i,t){this._toastrService.show("",t,{status:i,destroyByClick:!0,duration:3e3,hasIcon:!1,position:p.fe3.TOP_RIGHT,preventDuplicates:!0})}}return a.\u0275fac=function(i){return new(i||a)(e.\u0275\u0275directiveInject(d.qu),e.\u0275\u0275directiveInject(g.k),e.\u0275\u0275directiveInject(h.B),e.\u0275\u0275directiveInject(p.quB),e.\u0275\u0275directiveInject(p.X4l))},a.\u0275cmp=e.\u0275\u0275defineComponent({type:a,selectors:[["ngx-resident-form"]],inputs:{resident:"resident",primario:"primario",secundario:"secundario",onlyPermissions:"onlyPermissions"},decls:16,vars:4,consts:[[1,"row","detail-container"],[1,"col-lg-12"],["fullWidth",""],["tabTitle","Informaci\xf3n",4,"ngIf"],["tabTitle","Residencia",4,"ngIf"],["tabTitle","Permisos",3,"nbSpinner"],[1,"row"],[4,"ngFor","ngForOf"],[1,"row","pt-1"],[1,"col-12"],["nbButton","","status","info","hero","",3,"click"],["tabTitle","Informaci\xf3n"],[4,"ngIf"],[1,"col-md-6"],[1,"detail","py-1"],[1,"col-md-12","pt-2"],[1,"mt-2",3,"formGroup"],[1,"form-group"],["for","inputNombres",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","nombres"],["for","inputApellidos",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","apellidos"],["for","inputCedula",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","cedula"],["for","inputCorreo",1,"label"],["nbInput","","fullWidth","","type","email","formControlName","correo"],["for","inputSexo",1,"label"],["fullWidth","","name","inputSexo","status","primary","formControlName","sexo",1,"w-100"],["selected","","disabled",""],["value","FEMENINO"],["value","MASCULINO"],["for","inputFechaNacimiento",1,"label"],["nbInput","","fullWidth","",3,"ngModel","ngModelOptions","nbDatepicker","ngModelChange"],[3,"dateChange"],["datepicker",""],["for","inputNacionalidad",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","nacionalidad"],[1,"col-md-12"],["nbButton","","status","danger","hero","",1,"mr-2",3,"click"],["tabTitle","Residencia"],["for","inputPrimario",1,"label"],["fullWidth","","id","inputPrimario",3,"ngModel","ngModelOptions","selectedChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","inputSecundario",1,"label"],["fullWidth","","id","inputSecundario","formControlName","id_secundario","placeholder","Seleccionar una opci\xf3n"],["class","row",4,"ngIf"],["for","inputDescripcion",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","descripcion"],[3,"value"],["nbInput","","fullWidth","","type","text","formControlName","correo"],[1,"col-6","py-1"],[3,"checked","checkedChange"],["class","col-6 py-1",4,"ngFor","ngForOf"],[3,"checked","disabled","checkedChange"]],template:function(i,t){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-header"),e.\u0275\u0275text(4,"Editar Residente"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"nb-card-body")(6,"nb-tabset",2),e.\u0275\u0275template(7,E,3,2,"nb-tab",3),e.\u0275\u0275template(8,T,26,9,"nb-tab",4),e.\u0275\u0275elementStart(9,"nb-tab",5)(10,"div",6),e.\u0275\u0275template(11,_,2,1,"ng-container",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",8)(13,"div",9)(14,"button",10),e.\u0275\u0275listener("click",function(){return t.updatePermissions()}),e.\u0275\u0275text(15,"Actualizar"),e.\u0275\u0275elementEnd()()()()()()()()()),2&i&&(e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",!t.onlyPermissions),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.onlyPermissions),e.\u0275\u0275advance(1),e.\u0275\u0275property("nbSpinner",t.isLoading),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.permissionList))},dependencies:[C.sg,C.O5,d._Y,d.Fj,d.JJ,d.JL,d.On,d.sg,d.u,p.Asz,p.yKW,p.ndF,p.h8i,p.DPz,p.rs,p.q51,p.kyn,p.TR4,p.NTf,p.Q7R,p.$kf,p.B4C],styles:[".detail-container[_ngcontent-%COMP%]{width:700px}"]}),a})()},46609:(O,x,c)=>{c.d(x,{o:()=>a});var d=c(15861),p=c(74385),e=c(36517),g=c(42658),h=c(36749),C=c(6494),P=c(68360),v=c(80574),s=c(30551),E=c(7672),y=c(18328),I=c(12368),S=c(36895),T=c(94176);const M=["stepper"],m=["password"];function f(l,i){if(1&l&&(s.\u0275\u0275elementStart(0,"nb-option",14),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),2&l){const t=i.$implicit,n=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("value",t),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate1(" ",n.statusList[t]," ")}}function _(l,i){if(1&l){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"nb-select",12),s.\u0275\u0275listener("selectedChange",function(r){s.\u0275\u0275restoreView(t);const o=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(o.getResidents(o.placeId,r))}),s.\u0275\u0275template(2,f,2,2,"nb-option",13),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(2&l){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("selected",t.selectedStatus),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngForOf",t.status)}}function b(l,i){if(1&l&&(s.\u0275\u0275elementStart(0,"div",15)(1,"h6"),s.\u0275\u0275text(2,"Clave temporal del usuario"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"p",16),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd()()),2&l){const t=i.$implicit;s.\u0275\u0275advance(4),s.\u0275\u0275textInterpolate(t)}}let a=(()=>{class l{constructor(t,n,r,o,u,R){this._router=t,this._activatedRoute=n,this._dialogService=r,this._toastrService=o,this._residentService=u,this._placeService=R,this.status=["T"],this.primario="Primario",this.secundario="Secundario",this.statusList={T:"Todos",A:"Activo",P:"Pendiente",I:"Inactivo",R:"Rechazado",E:"Eliminado"},this.customActions={approve:{name:"approve",title:'<i class="nb-checkmark" title="Aprobar"></i>'},decline:{name:"decline",title:'<i class="nb-close" title="Rechazar"></i>'},edit:{name:"edit",title:'<i class="nb-edit"></i>'},delete:{name:"delete",title:'<i class="nb-trash"></i>'},resetPassword:{name:"resetPassword",title:'<img src="./assets/images/key-outline.svg" title="Restablecer contrase\xf1a">'},logout:{name:"logout",title:'<img src="./assets/images/log-out-outline.svg" title="Cerrar sesi\xf3n">'},verify:{name:"verify",title:'<img src="./assets/images/person-done-outline.svg" title="Verificar">'},sendVerificationEmail:{name:"sendVerificationEmail",title:'<i class="nb-email" title="Enviar correo de verificaci\xf3n"></i>'},updatePlace:{name:"updatePlace",title:'<i class="nb-home" title="Solicitar actualizaci\xf3n de lugar"></i>'},updateInfo:{name:"updateInfo",title:'<i class="nb-list" title="Solicitar actualizaci\xf3n de informaci\xf3n"></i>'},accessReport:{name:"accessReport",title:'<img src="./assets/images/checklist.svg" title="Reporte de ingreso">'}},this.settings={actions:{position:"right",add:!1,edit:!1,delete:!1,custom:[]},columns:{nombres:{title:"Nombres",type:"string",filter:!0},apellidos:{title:"Apellidos",type:"string",filter:!0},cedula:{title:"Cedula",type:"string",filter:!0},correo:{title:"Correo",type:"string",filter:!0},celular:{title:"Celular",type:"string",filter:!0},nombre_primario:{title:this.primario,type:"string",filter:!0},nombre_secundario:{title:this.secundario,type:"string",filter:!0},descripcion:{title:"Descripci\xf3n",type:"string",filter:!0}}},this.residentsList=[],this.source=new p.nC;const F=this._activatedRoute.parent.snapshot.paramMap.get("placeId");F&&(this.placeId=parseInt(F));const w=this._activatedRoute.snapshot.data.status;w&&(this.status=w)}ngOnInit(){this._placeService.getPlace({id_lugar:this.placeId}).subscribe(t=>{this.primario=t.primario,this.secundario=t.secundario}),this.selectedStatus=this.status[0],this.getResidents(this.placeId,this.selectedStatus),this.setActions()}setActions(){var t=this;switch(this.settings.actions.custom=[],this.selectedStatus){case"P":this.settings.actions.custom.push(this.customActions.approve),this.settings.actions.custom.push(this.customActions.decline);break;case"A":this.settings.actions.custom.push(this.customActions.accessReport,this.customActions.updatePlace,this.customActions.updateInfo,this.customActions.logout,this.customActions.resetPassword,this.customActions.edit,this.customActions.delete),this.settings.columns.estado={title:"Estado",type:"custom",renderComponent:h.P,onComponentInitFunction:n=>{n.toggle.subscribe(function(){var r=(0,d.Z)(function*(o){const u=o.value?"A":"I";yield t.updateStatus(o.row.id_residente_lugar,u),t.getResidents(t.placeId,t.selectedStatus)});return function(o){return r.apply(this,arguments)}}())},filter:!1};break;case"I":case"R":case"E":this.settings.actions.custom.push(this.customActions.approve),this.settings.actions.custom.push(this.customActions.delete)}}getResidents(t,n){this.selectedStatus=n,this.secundarioId?this._residentService.getBySecundario({id_secundario:this.secundarioId}).subscribe({next:r=>{this.residentsList=r,this.source.load(r)},error:r=>{console.error(r)}}):this._residentService.getByPlace({id_lugar:t,estado:n}).subscribe({next:o=>{this.residentsList=o,this.source.load(o)},error:o=>{console.error(o)}})}onCustom(t){switch(t.action){case"edit":this._dialogService.open(C.P,{context:{resident:t.data,primario:this.primario,secundario:this.secundario}}).onClose.subscribe(()=>{this.getResidents(this.placeId,this.selectedStatus)});break;case"delete":"A"==this.selectedStatus?this.onUpdateStatus(t.data.id_residente_lugar,"E"):this.onDelete(t.data.id_residente_lugar);break;case"approve":this.onApprove(t.data,"A");break;case"decline":this.onUpdateStatus(t.data.id_residente_lugar,"R");break;case"resetPassword":this.onResetPassword(t.data.id_residente);break;case"logout":this.onResidentLogout(t.data.id_residente);break;case"verify":this.onVerify(t.data.id_residente);break;case"sendVerificationEmail":this.onSendVerificationEmail(t.data.id_residente);break;case"updatePlace":this.onUpdatePlace(t.data.id_residente_lugar);break;case"updateInfo":this.onUpdateInfo(t.data.id_residente);break;case"accessReport":this.stepperComponent.next(),this.selectedResidentId=t.data.id_residente_lugar,this.selectedResidentPlaceId=t.data.id_residente}}add(){this._router.navigate(["/pages/residentes/crear"])}onDelete(t){this._dialogService.open(g.S,{context:{title:"\xbfEst\xe1 seguro de eliminar el registro?"}}).onClose.subscribe({next:n=>{n&&this.deleteResident(t)}})}deleteResident(t){this._residentService.delete({id_residente_lugar:t,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Residente eliminado"),this.getResidents(this.placeId,this.selectedStatus)},error:()=>{this.showToast("danger","Error al eliminar el residente")}})}onApprove(t,n){var r=this;this._dialogService.open(C.P,{context:{resident:t,primario:this.primario,secundario:this.secundario,onlyPermissions:!0}}).onClose.subscribe(function(){var o=(0,d.Z)(function*(u){u&&(yield r.updateStatus(t.id_residente_lugar,n),r.getResidents(r.placeId,r.selectedStatus))});return function(u){return o.apply(this,arguments)}}())}onUpdateStatus(t,n){var o,r=this;this._dialogService.open(g.S,{context:{title:"\xbfEst\xe1 seguro de actualizar el estado del registro?"}}).onClose.subscribe({next:(o=(0,d.Z)(function*(u){u&&(yield r.updateStatus(t,n),r.getResidents(r.placeId,r.selectedStatus))}),function(R){return o.apply(this,arguments)})})}updateStatus(t,n){return new Promise(r=>{this._residentService.updateStatus({id_residente_lugar:t,estado:n,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Estado actualizado")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")},complete:()=>{setTimeout(()=>{r()},0)}})})}onResetPassword(t){this._dialogService.open(g.S,{context:{title:"\xbfEst\xe1 seguro de restablecer la contrase\xf1a del residente?"}}).onClose.subscribe({next:n=>{n&&this.resetPassword(t)}})}resetPassword(t){this._residentService.resetPassword({id_residente:t,usuario_modificacion:"admin"}).subscribe({next:r=>{this._dialogService.open(this.dialog,{context:r.clave})},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onResidentLogout(t){this._dialogService.open(g.S,{context:{title:"\xbfEst\xe1 seguro de cerrar la sesi\xf3n del residente?"}}).onClose.subscribe({next:n=>{n&&this.residentLogout(t)}})}residentLogout(t){this._residentService.residentLogout({id_residente:t,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Sesi\xf3n finalizada")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onVerify(t){this._dialogService.open(g.S,{context:{title:"\xbfEst\xe1 seguro de verificar la cuenta del residente?"}}).onClose.subscribe({next:n=>{n&&this.verify(t)}})}verify(t){this._residentService.verify({id_residente:t,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Cuenta verificada")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onSendVerificationEmail(t){this._dialogService.open(g.S,{context:{title:"\xbfEst\xe1 seguro de enviar el correo de verificaci\xf3n al residente?"}}).onClose.subscribe({next:n=>{n&&this.sendVerificationEmail(t)}})}sendVerificationEmail(t){this._residentService.sendVerificationEmail({id_residente:t,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Correo enviado")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onUpdatePlace(t){this._dialogService.open(g.S,{context:{title:"\xbfEst\xe1 seguro de solicitar la actualizaci\xf3n de lugar?"}}).onClose.subscribe({next:n=>{n&&this.updatePlace(t)}})}updatePlace(t){this._residentService.updatePlace({id_residente_lugar:t,estado:"S",usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Solicitud establecida")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onUpdateInfo(t){this._dialogService.open(g.S,{context:{title:"\xbfEst\xe1 seguro de solicitar la actualizaci\xf3n de informaci\xf3n?"}}).onClose.subscribe({next:n=>{n&&this.updateInfo(t)}})}updateInfo(t){this._residentService.updateInfo({id_residente:t,estado:"P",usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Solicitud establecida")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}showToast(t,n){this._toastrService.show("",n,{status:t,destroyByClick:!0,duration:3e3,hasIcon:!1,position:e.fe3.TOP_RIGHT,preventDuplicates:!0})}getTable(){return new Promise(t=>{const n=[];this.residentsList.forEach(r=>{let o=new P.oB(r);n.push(o)}),setTimeout(()=>{t(n)},0)})}downloadReport(){var t=this;return(0,d.Z)(function*(){const n=yield t.getTable(),r=v.P6.json_to_sheet(n),o=v.P6.book_new();v.P6.book_append_sheet(o,r,"SheetName"),v.NC(o,"residentes.xlsx")})()}}return l.\u0275fac=function(t){return new(t||l)(s.\u0275\u0275directiveInject(E.F0),s.\u0275\u0275directiveInject(E.gz),s.\u0275\u0275directiveInject(e.Gln),s.\u0275\u0275directiveInject(e.quB),s.\u0275\u0275directiveInject(y.B),s.\u0275\u0275directiveInject(I.k))},l.\u0275cmp=s.\u0275\u0275defineComponent({type:l,selectors:[["ngx-residents-list"]],viewQuery:function(t,n){if(1&t&&(s.\u0275\u0275viewQuery(M,5),s.\u0275\u0275viewQuery(m,5)),2&t){let r;s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(n.stepperComponent=r.first),s.\u0275\u0275queryRefresh(r=s.\u0275\u0275loadQuery())&&(n.dialog=r.first)}},inputs:{placeId:"placeId",secundarioId:"secundarioId",status:"status",primario:"primario",secundario:"secundario"},decls:19,vars:7,consts:[["orientation","horizontal",3,"disableStepNavigation"],["stepper",""],["label","Residentes"],[1,"w-100","d-flex","justify-content-between"],[1,"d-flex"],[4,"ngIf"],["nbButton","","hero","","status","success",3,"disabled","click"],[1,"material-symbols-outlined"],[1,"custom-table",3,"settings","source","custom"],["label","Ingresos"],[3,"residentId","residentPlaceId","back"],["password",""],["status","basic",1,"pr-4",3,"selected","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"password-container"],[1,"text-center","pt-3"]],template:function(t,n){1&t&&(s.\u0275\u0275elementStart(0,"nb-stepper",0,1)(2,"nb-step",2)(3,"nb-card")(4,"nb-card-header",3)(5,"h5"),s.\u0275\u0275text(6,"Residentes"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(7,"div",4),s.\u0275\u0275template(8,_,3,2,"ng-container",5),s.\u0275\u0275elementStart(9,"button",6),s.\u0275\u0275listener("click",function(){return n.downloadReport()}),s.\u0275\u0275elementStart(10,"span",7),s.\u0275\u0275text(11,"download"),s.\u0275\u0275elementEnd(),s.\u0275\u0275text(12," Descargar "),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(13,"nb-card-body")(14,"ng2-smart-table",8),s.\u0275\u0275listener("custom",function(o){return n.onCustom(o)}),s.\u0275\u0275elementEnd()()()(),s.\u0275\u0275elementStart(15,"nb-step",9)(16,"ngx-access-report-table",10),s.\u0275\u0275listener("back",function(){return n.stepperComponent.previous()}),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275template(17,b,5,1,"ng-template",null,11,s.\u0275\u0275templateRefExtractor)),2&t&&(s.\u0275\u0275property("disableStepNavigation",!0),s.\u0275\u0275advance(8),s.\u0275\u0275property("ngIf",n.status.length>1),s.\u0275\u0275advance(1),s.\u0275\u0275property("disabled",!n.residentsList||0===n.residentsList.length),s.\u0275\u0275advance(5),s.\u0275\u0275property("settings",n.settings)("source",n.source),s.\u0275\u0275advance(2),s.\u0275\u0275property("residentId",n.selectedResidentId)("residentPlaceId",n.selectedResidentPlaceId))},dependencies:[S.sg,S.O5,e.Asz,e.yKW,e.ndF,p.T5,e.DPz,e.rs,e.q51,e.TLo,e.Sv4,T.y],styles:["[_nghost-%COMP%]     nb-stepper .header{display:none}[_nghost-%COMP%]     [nbButton].appearance-ghost.status-basic:hover, .appearance-ghost.status-basic[nbButtonToggle][_ngcontent-%COMP%]:hover{background-color:transparent}[_nghost-%COMP%]     nb-stepper .step-content{padding:0}[_nghost-%COMP%]     tr .ng2-smart-actions{height:auto}[_nghost-%COMP%]     ng2-st-tbody-custom{display:flex;align-items:center}[_nghost-%COMP%]     ng2-st-tbody-custom a.ng2-smart-action.ng2-smart-action-custom-custom{display:flex;align-items:center;text-align:center}[_nghost-%COMP%]     ng2-st-tbody-custom a.ng2-smart-action.ng2-smart-action-custom-custom img{width:22px;filter:contrast(.3)}.password-container[_ngcontent-%COMP%]{padding:20px;background-color:#fff}"]}),l})()},39263:(O,x,c)=>{c.r(x),c.d(x,{ResidentsModule:()=>M});var d=c(36517),p=c(74385),e=c(7672),g=c(6494),h=c(30551);let C=(()=>{class m{constructor(){}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=h.\u0275\u0275defineComponent({type:m,selectors:[["ngx-residents"]],decls:1,vars:0,template:function(_,b){1&_&&h.\u0275\u0275element(0,"router-outlet")},dependencies:[e.lC],encapsulation:2}),m})();var P=c(20732),v=c(46609);const E=[{path:"",component:C,children:[{path:"",component:(()=>{class m{constructor(_){this._activatedRoute=_;const b=this._activatedRoute.parent.parent.parent.snapshot.paramMap.get("placeId");b&&(this.placeId=parseInt(b)),this.status=this._activatedRoute.snapshot.data.status}}return m.\u0275fac=function(_){return new(_||m)(h.\u0275\u0275directiveInject(e.gz))},m.\u0275cmp=h.\u0275\u0275defineComponent({type:m,selectors:[["ngx-index"]],decls:2,vars:2,consts:[[3,"placeId","status"]],template:function(_,b){1&_&&(h.\u0275\u0275elementStart(0,"ngx-no-padding-layout"),h.\u0275\u0275element(1,"ngx-residents-list",0),h.\u0275\u0275elementEnd()),2&_&&(h.\u0275\u0275advance(1),h.\u0275\u0275property("placeId",b.placeId)("status",b.status))},dependencies:[P.F,v.o]}),m})()},{path:"crear",component:g.P},{path:"editar",component:g.P}]}];let y=(()=>{class m{}return m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=h.\u0275\u0275defineNgModule({type:m}),m.\u0275inj=h.\u0275\u0275defineInjector({imports:[e.Bz.forChild(E),e.Bz]}),m})();var I=c(24006),S=c(27074),T=c(78253);let M=(()=>{class m{}return m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=h.\u0275\u0275defineNgModule({type:m}),m.\u0275inj=h.\u0275\u0275defineInjector({imports:[S.O,I.u5,I.UX,y,d.zyh,p.ne,d.nKr,d.T2N,d.IIj,d.KdK,d.EoG,d.MfT,d.uuI,d.OA,d.obu,T.AccessReportModule]}),m})()}}]);