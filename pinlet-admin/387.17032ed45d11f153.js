"use strict";(self.webpackChunkngx_admin_demo=self.webpackChunkngx_admin_demo||[]).push([[387],{13387:(D,f,l)=>{l.r(f),l.d(f,{BlackListsModule:()=>W});var L=l(97137),c=l(24006),r=l(36517),h=l(74385),m=l(7672),k=l(42658),I=l(36749),v=l(15861),e=l(94650),C=l(92340),S=l(80529);let b=(()=>{class n{constructor(t){this.http=t,this.apiUrl=C.N.apiUrl}getAll(t){return this.http.post(`${this.apiUrl}/getAllListaNegra_lugar`,t)}getById(t){return this.http.post(`${this.apiUrl}/getListaNegra`,t)}create(t){return this.http.post(`${this.apiUrl}/insertListaNegra`,t)}update(t){return this.http.post(`${this.apiUrl}/updateListaNegra`,t)}delete(t){return this.http.post(`${this.apiUrl}/deleteListaNegra`,t)}updateStatus(t){return this.http.post(`${this.apiUrl}/updateEstadoListaNegra`,t)}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275inject(S.eN))},n.\u0275prov=e.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var x=l(12368),_=l(36895);function B(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div")(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.nombrePrimario)}}function y(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"nb-option",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=a.$implicit;e.\u0275\u0275property("value",t.value),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.title," ")}}function F(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"nb-select",20,21),e.\u0275\u0275listener("selectedChange",function(o){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.getSecundarios(o))}),e.\u0275\u0275template(2,y,2,2,"nb-option",22),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("selected",t.selectedPrimario),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.primarios)}}function E(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"div")(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.nombreSecundario)}}function T(n,a){if(1&n&&(e.\u0275\u0275elementStart(0,"nb-option",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&n){const t=a.$implicit;e.\u0275\u0275property("value",t.value),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.title," ")}}function j(n,a){if(1&n){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"nb-select",24,25),e.\u0275\u0275listener("selectedChange",function(o){e.\u0275\u0275restoreView(t);const s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onSecundarioSelected(o))}),e.\u0275\u0275template(2,T,2,2,"nb-option",22),e.\u0275\u0275elementEnd()}if(2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("selected",t.blackListForm.value.id_secundario),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.secundarios)}}function w(n,a){1&n&&(e.\u0275\u0275elementStart(0,"p",27),e.\u0275\u0275text(1," El campo es obligatorio "),e.\u0275\u0275elementEnd())}function N(n,a){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,w,2,0,"p",26),e.\u0275\u0275elementContainerEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.blackListForm.get("nombre").hasError("required"))}}function P(n,a){1&n&&(e.\u0275\u0275elementStart(0,"p",27),e.\u0275\u0275text(1," El campo es obligatorio "),e.\u0275\u0275elementEnd())}function R(n,a){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,P,2,0,"p",26),e.\u0275\u0275elementContainerEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.blackListForm.get("cedula").hasError("required"))}}function M(n,a){1&n&&(e.\u0275\u0275elementStart(0,"p",27),e.\u0275\u0275text(1," El campo es obligatorio "),e.\u0275\u0275elementEnd())}function z(n,a){if(1&n&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,M,2,0,"p",26),e.\u0275\u0275elementContainerEnd()),2&n){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.blackListForm.get("motivo").hasError("required"))}}let g=(()=>{class n{constructor(t,i,o,s,p,d,u){this._formBuilder=t,this._activatedRoute=i,this._blackListService=o,this._placeService=s,this._toastrService=p,this._cdRef=d,this._dialogRef=u,this.primarios=[],this.secundarios=[],this.isLoading=!1,this._activatedRoute.params.subscribe($=>{this.blackListId=$.id}),this.initForm()}ngOnInit(){this.getPrimarios(this.placeId),this.blackListId?(this.getBlackList(),this.action="Editar"):(this.action="Crear",this.blackListForm.patchValue({id_lugar:this.placeId}))}initForm(){this.blackListForm=this._formBuilder.group({id_lugar:["",c.kI.required],id_secundario:["",c.kI.required],nombre:["",c.kI.required],cedula:["",c.kI.required],motivo:["",c.kI.required],usuario_creacion:["admin",c.kI.required]})}getBlackList(){var i,t=this;this._blackListService.getById({id_lista_negra:this.blackListId}).subscribe({next:(i=(0,v.Z)(function*(o){t.blackListForm.patchValue(o),yield t.getSecundarios(o.id_primario),t.onSecundarioSelected(o.id_secundario),t.selectedPrimario=o.id_primario,t.nombrePrimario=t.primarios.find(s=>s.value==o.id_primario).title,t.nombreSecundario=t.secundarios.find(s=>s.value==o.id_secundario).title}),function(s){return i.apply(this,arguments)}),error:i=>{console.error(i)}})}getPrimarios(t){this._placeService.getPrimarios({id_usuario:1,id_lugar:t}).subscribe({next:o=>{this.primarios=o.map(s=>({title:s.nombre_primario,value:s.id_primario}))},error:o=>{}})}getSecundarios(t){var i=this;return(0,v.Z)(function*(){return new Promise((o,s)=>{i._placeService.getSecundarios({id_usuario:1,id_primario:t}).subscribe({next:d=>{i.secundarios=d.map(u=>({title:u.nombre_secundario,value:u.id_secundario})),o()},error:d=>{s()}})})})()}onSecundarioSelected(t){this.blackListForm.patchValue({id_secundario:t})}save(){this.isLoading=!0;const t=this.blackListForm.value;this.blackListId?(t.id_lista_negra=this.blackListId,t.usuario_modificacion="admin",this.update(t)):(t.usuario_creacion="admin",this.create(t))}create(t){this._blackListService.create(t).subscribe({next:()=>{this.isLoading=!1,this.showToast("success","Registro creado"),this._dialogRef.close(!0)},error:()=>{this.isLoading=!1,this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}update(t){this._blackListService.update(t).subscribe({next:()=>{this.isLoading=!1,this.showToast("success","Registro actualizado"),this._dialogRef.close(!0)},error:()=>{this.isLoading=!1,this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}showToast(t,i){this._toastrService.show("",i,{status:t,destroyByClick:!0,duration:3e3,hasIcon:!1,position:r.fe3.TOP_RIGHT,preventDuplicates:!0})}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(m.gz),e.\u0275\u0275directiveInject(b),e.\u0275\u0275directiveInject(x.k),e.\u0275\u0275directiveInject(r.quB),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(r.X4l))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["ngx-black-list-form"]],decls:43,vars:10,consts:[[1,"w-100","d-flex","justify-content-between"],["nbButton","","status","info","hero","",3,"disabled","click"],[1,"container"],[3,"formGroup"],[1,"row"],[1,"col-sm-6"],[1,"form-group"],["for","inputIdPrimario",1,"label"],[4,"ngIf"],["fullWidth","","id","inputIdPrimario","placeholder","Seleccione una opci\xf3n",3,"selected","selectedChange",4,"ngIf"],[1,"col-md-6"],["for","inputIdSecundario",1,"label"],["fullWidth","","id","inputIdSecundario","placeholder","Seleccione una opci\xf3n",3,"selected","selectedChange",4,"ngIf"],["for","inputNombre",1,"label"],["id","inputNombre","type","text","nbInput","","fullWidth","","formControlName","nombre"],["for","inputCedula",1,"label"],["id","inputCedula","type","text","nbInput","","fullWidth","","formControlName","cedula"],[1,"col-md-12"],["for","inputMotivo",1,"label"],["id","inputMotivo","nbInput","","fullWidth","","formControlName","motivo"],["fullWidth","","id","inputIdPrimario","placeholder","Seleccione una opci\xf3n",3,"selected","selectedChange"],["inputIdPrimario",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["fullWidth","","id","inputIdSecundario","placeholder","Seleccione una opci\xf3n",3,"selected","selectedChange"],["inputIdSecundario",""],["class","caption status-danger",4,"ngIf"],[1,"caption","status-danger"]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"nb-card")(1,"nb-card-header",0)(2,"h5"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"button",1),e.\u0275\u0275listener("click",function(){return i.save()}),e.\u0275\u0275text(6," Guardar "),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"nb-card-body")(8,"div",2)(9,"form",3)(10,"div",4)(11,"div",5)(12,"div",6)(13,"label",7),e.\u0275\u0275text(14,"Primario"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,B,3,1,"div",8),e.\u0275\u0275template(16,F,3,2,"nb-select",9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div",10)(18,"div",6)(19,"label",11),e.\u0275\u0275text(20,"Secundario"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(21,E,3,1,"div",8),e.\u0275\u0275template(22,j,3,2,"nb-select",12),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(23,"div",4)(24,"div",10)(25,"div",6)(26,"label",13),e.\u0275\u0275text(27,"Nombre"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(28,"input",14),e.\u0275\u0275template(29,N,2,1,"ng-container",8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(30,"div",10)(31,"div",6)(32,"label",15),e.\u0275\u0275text(33,"C\xe9dula"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"input",16),e.\u0275\u0275template(35,R,2,1,"ng-container",8),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(36,"div",4)(37,"div",17)(38,"div",6)(39,"label",18),e.\u0275\u0275text(40,"Motivo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(41,"textarea",19),e.\u0275\u0275template(42,z,2,1,"ng-container",8),e.\u0275\u0275elementEnd()()()()()()()),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",i.action," Lista negra"),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!i.blackListForm.valid||i.isLoading),e.\u0275\u0275advance(4),e.\u0275\u0275property("formGroup",i.blackListForm),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.blackListId),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!i.blackListId),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.blackListId),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!i.blackListId),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",i.blackListForm.get("nombre").invalid&&i.blackListForm.get("nombre").touched),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",i.blackListForm.get("cedula").invalid&&i.blackListForm.get("cedula").touched),e.\u0275\u0275advance(7),e.\u0275\u0275property("ngIf",i.blackListForm.get("motivo").invalid&&i.blackListForm.get("motivo").touched))},dependencies:[_.sg,_.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,r.Asz,r.yKW,r.ndF,r.h8i,r.DPz,r.rs,r.q51]}),n})();var O=l(20732);const U=[{path:"",component:(()=>{class n{constructor(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["ngx-black-lists"]],decls:1,vars:0,template:function(t,i){1&t&&e.\u0275\u0275element(0,"router-outlet")},dependencies:[m.lC],encapsulation:2}),n})(),children:[{path:"",component:(()=>{class n{constructor(t,i,o,s){this._blackListService=t,this._activatedRoute=i,this._dialogService=o,this._toastrService=s,this.settings={actions:{position:"right",add:!1,edit:!1,delete:!1,custom:[{name:"edit",title:'<i class="nb-edit"></i>'},{name:"delete",title:'<i class="nb-trash"></i>'}]},columns:{nombre:{title:"Nombre",type:"string",filter:!1},cedula:{title:"C\xe9dula",type:"string",filter:!1},motivo:{title:"Motivo",type:"string",filter:!1},nombre_primario:{title:"Primario",type:"string",filter:!1},nombre_secundario:{title:"Secundario",type:"string",filter:!1},estado:{title:"Estado",type:"custom",filter:!1,renderComponent:I.P,onComponentInitFunction:p=>{p.toggle.subscribe(d=>{this.updateStatus(d.row.id_lista_negra,d.value?"A":"I")})}}}},this.source=new h.nC}ngOnInit(){this.placeId=parseInt(this._activatedRoute.parent.parent.parent.snapshot.paramMap.get("placeId")),this.getBlackLists()}getBlackLists(){this._blackListService.getAll({id_lugar:this.placeId}).subscribe({next:t=>{this.blackList=t,this.source.load(t)}})}onCustom(t){switch(t.action){case"edit":this.onEdit(t.data.id_lista_negra);break;case"delete":this.onDelete(t.data.id_lista_negra)}}add(){this._dialogService.open(g,{context:{placeId:this.placeId}}).onClose.subscribe({next:t=>{t&&this.getBlackLists()}})}onEdit(t){this._dialogService.open(g,{context:{placeId:this.placeId,blackListId:t}}).onClose.subscribe({next:i=>{i&&this.getBlackLists()}})}onDelete(t){this._dialogService.open(k.S,{context:{title:"\xbfEst\xe1 seguro de borrar el registro?"}}).onClose.subscribe({next:i=>{i&&this.delete(t)}})}delete(t){this._blackListService.delete({id_lista_negra:t,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Registro eliminado"),this.getBlackLists()},error:()=>{this.showToast("danger","Error al eliminar el registro")}})}updateStatus(t,i){this._blackListService.updateStatus({id_lista_negra:t,estado:i,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Estado de registro actualizado")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}showToast(t,i){this._toastrService.show("",i,{status:t,destroyByClick:!0,duration:3e3,hasIcon:!1,position:r.fe3.TOP_RIGHT,preventDuplicates:!0})}}return n.\u0275fac=function(t){return new(t||n)(e.\u0275\u0275directiveInject(b),e.\u0275\u0275directiveInject(m.gz),e.\u0275\u0275directiveInject(r.Gln),e.\u0275\u0275directiveInject(r.quB))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["ngx-black-lists-list"]],decls:9,vars:2,consts:[[1,"w-100","d-flex","justify-content-between"],["nbButton","","status","info","hero","",3,"click"],[1,"custom-table",3,"settings","source","custom"]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"ngx-no-padding-layout")(1,"nb-card")(2,"nb-card-header",0)(3,"h5"),e.\u0275\u0275text(4,"Lista negra"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275listener("click",function(){return i.add()}),e.\u0275\u0275text(6," Nuevo "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"nb-card-body")(8,"ng2-smart-table",2),e.\u0275\u0275listener("custom",function(s){return i.onCustom(s)}),e.\u0275\u0275elementEnd()()()()),2&t&&(e.\u0275\u0275advance(8),e.\u0275\u0275property("settings",i.settings)("source",i.source))},dependencies:[O.F,r.Asz,r.yKW,r.ndF,h.T5,r.DPz]}),n})()},{path:"crear",component:g}]}];let V=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[m.Bz.forChild(U),m.Bz]}),n})(),W=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=e.\u0275\u0275defineInjector({imports:[L.O,c.u5,c.UX,V,r.zyh,h.ne,r.nKr,r.T2N,r.IIj]}),n})()}}]);