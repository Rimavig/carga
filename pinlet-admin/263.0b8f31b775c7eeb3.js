"use strict";(self.webpackChunkngx_admin_demo=self.webpackChunkngx_admin_demo||[]).push([[263],{16469:(O,E,d)=>{d.d(E,{t:()=>l});var l=(()=>{return(c=l||(l={}))[c.residentesPendientes=1]="residentesPendientes",c[c.residentesActivos=2]="residentesActivos",c[c.residentesInactivos=3]="residentesInactivos",c[c.anuncios=4]="anuncios",c[c.primariosSecundarios=5]="primariosSecundarios",c[c.reportes=6]="reportes",c[c.chat=7]="chat",c[c.servicios=8]="servicios",c[c.tarjeta=9]="tarjeta",c[c.accesos=10]="accesos",c[c.notificaciones=11]="notificaciones",l;var c})()},56227:(O,E,d)=>{d.d(E,{P:()=>D});var l=d(24006),c=d(36517),v=d(42658),S=d(16469),f=d(92340),e=d(30551),y=d(12368),w=d(18328),i=d(80529);let k=(()=>{class a{constructor(t){this.http=t,this.apiUrl=f.N.apiUrl}getByResidentPlaceId(t){return this.http.post(`${this.apiUrl}/getAllSecundarioOtros_residenteLugar`,t)}create(t){return this.http.post(`${this.apiUrl}/insertSecundario_otros`,t)}delete(t){return this.http.post(`${this.apiUrl}/deleteSecundario_otros`,t)}}return a.\u0275fac=function(t){return new(t||a)(e.\u0275\u0275inject(i.eN))},a.\u0275prov=e.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var V=d(98914),P=d(36895);function A(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",26)(2,"button",27),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.approve())}),e.\u0275\u0275elementStart(3,"span",28),e.\u0275\u0275text(4,"check"),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(5," Aprobar "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}}function M(a,h){if(1&a&&e.\u0275\u0275element(0,"img",37),2&a){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("src",t.selectedResidentPicture,e.\u0275\u0275sanitizeUrl)}}function L(a,h){1&a&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1,"No tiene foto"),e.\u0275\u0275elementEnd())}function _(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",8)(2,"div",29)(3,"div",30)(4,"div"),e.\u0275\u0275template(5,M,1,1,"img",31),e.\u0275\u0275template(6,L,2,0,"span",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"a",32),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.showImageForm=!0)}),e.\u0275\u0275element(8,"nb-icon",33),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div",34)(10,"div",8)(11,"div",9)(12,"div",35)(13,"span"),e.\u0275\u0275text(14),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(15,"div",9)(16,"div",35)(17,"span"),e.\u0275\u0275text(18),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"div",9)(20,"div",35)(21,"span"),e.\u0275\u0275text(22),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(23,"div",9)(24,"div",35)(25,"span"),e.\u0275\u0275text(26),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(27,"div",9)(28,"div",35)(29,"span"),e.\u0275\u0275text(30),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(31,"div",9)(32,"div",35)(33,"span"),e.\u0275\u0275text(34),e.\u0275\u0275elementEnd()()()()()(),e.\u0275\u0275elementStart(35,"div",8)(36,"div",36)(37,"button",20),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.editMode=!0)}),e.\u0275\u0275text(38,"Editar"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd()}if(2&a){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",t.selectedResidentPicture),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.selectedResidentPicture),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate1("Nombres: ",t.resident.nombres,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("Apellidos: ",t.resident.apellidos,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("C\xe9dula: ",t.resident.cedula,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("Correo: ",t.resident.correo,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("Celular: ",t.resident.celular,""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("Descripci\xf3n: ",t.resident.descripcion,"")}}const R=function(){return{standalone:!0}};function b(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"form",7)(2,"div",8)(3,"div",9)(4,"div",10)(5,"label",38),e.\u0275\u0275text(6,"Nombres"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"input",39),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"div",9)(9,"div",10)(10,"label",40),e.\u0275\u0275text(11,"Apellidos"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(12,"input",41),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(13,"div",9)(14,"div",10)(15,"label",42),e.\u0275\u0275text(16,"C\xe9dula"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(17,"input",43),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",9)(19,"div",10)(20,"label",44),e.\u0275\u0275text(21,"Correo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(22,"input",45),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(23,"div",9)(24,"div",10)(25,"label",46),e.\u0275\u0275text(26,"Sexo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"nb-select",47)(28,"nb-option",48),e.\u0275\u0275text(29,"Seleccionar opci\xf3n"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(30,"nb-option",49),e.\u0275\u0275text(31,"FEMENINO"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(32,"nb-option",50),e.\u0275\u0275text(33,"MASCULINO"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(34,"div",9)(35,"div",10)(36,"label",51),e.\u0275\u0275text(37,"Fecha de nacimiento"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(38,"input",52),e.\u0275\u0275listener("ngModelChange",function(r){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(u.birthDate=r)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"nb-datepicker",53,54),e.\u0275\u0275listener("dateChange",function(r){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(u.onDateChanged(r))}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(41,"div",9)(42,"div",10)(43,"label",55),e.\u0275\u0275text(44,"Nacionalidad"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(45,"input",56),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(46,"div",8)(47,"div",17)(48,"button",57),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.editMode=!1)}),e.\u0275\u0275text(49,"Cancelar"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(50,"button",20),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.updateResident())}),e.\u0275\u0275text(51,"Actualizar"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd()}if(2&a){const t=e.\u0275\u0275reference(40),s=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",s.residentForm),e.\u0275\u0275advance(37),e.\u0275\u0275property("ngModel",s.birthDate)("ngModelOptions",e.\u0275\u0275pureFunction0(4,R))("nbDatepicker",t)}}function T(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"form",7)(2,"div",8)(3,"div",58),e.\u0275\u0275element(4,"img",37),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",8)(6,"div",17)(7,"div",10)(8,"input",59,60),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275reference(9),u=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(u.loadFile(r.files))}),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(10,"div",8)(11,"div",36)(12,"button",57),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.showImageForm=!1)}),e.\u0275\u0275text(13,"Cancelar"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",20),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.uploadImage())}),e.\u0275\u0275text(15,"Actualizar"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementContainerEnd()}if(2&a){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("formGroup",t.pictureForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("src",t.picture,e.\u0275\u0275sanitizeUrl)}}function B(a,h){if(1&a&&(e.\u0275\u0275elementStart(0,"nb-option",61),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const t=h.$implicit;e.\u0275\u0275property("value",t.id_primario),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.nombre_primario," ")}}function U(a,h){if(1&a&&(e.\u0275\u0275elementStart(0,"nb-option",61),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const t=h.$implicit;e.\u0275\u0275property("value",t.id_secundario),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.nombre_secundario," ")}}function $(a,h){1&a&&(e.\u0275\u0275elementStart(0,"div",8)(1,"div",17)(2,"div",10)(3,"label",44),e.\u0275\u0275text(4,"Correo"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"textarea",62),e.\u0275\u0275elementEnd()()())}function W(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",63)(1,"nb-checkbox",66),e.\u0275\u0275listener("checkedChange",function(r){const x=e.\u0275\u0275restoreView(t).$implicit,I=e.\u0275\u0275nextContext(3).$implicit,N=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(N.addOrRemovePermission(r,I.id_permiso,x.id_permiso))}),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()}if(2&a){const t=h.$implicit,s=e.\u0275\u0275nextContext(3).$implicit,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("checked","A"===t.estado)("disabled",!r.selectedPermissions.includes(s.id_permiso)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.nombre," ")}}function g(a,h){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,W,3,3,"div",65),e.\u0275\u0275elementContainerEnd()),2&a){const t=e.\u0275\u0275nextContext(2).$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.dependientes)}}function C(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",63)(2,"nb-checkbox",64),e.\u0275\u0275listener("checkedChange",function(r){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext().$implicit,x=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(x.addOrRemovePermission(r,u.id_permiso))}),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,g,2,1,"ng-container",3),e.\u0275\u0275elementContainerEnd()}if(2&a){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275property("checked","A"===t.estado),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.permiso),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.dependientes.length>0)}}function n(a,h){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,C,5,3,"ng-container",3),e.\u0275\u0275elementContainerEnd()),2&a){const t=h.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","E"!==t.estado)}}function o(a,h){if(1&a&&(e.\u0275\u0275elementStart(0,"nb-option",61),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const t=h.$implicit;e.\u0275\u0275property("value",t.id_primario),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.nombre_primario," ")}}function m(a,h){if(1&a&&(e.\u0275\u0275elementStart(0,"nb-option",61),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&a){const t=h.$implicit;e.\u0275\u0275property("value",t.id_secundario),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.nombre_secundario," ")}}function p(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",8)(1,"div",9)(2,"div",10)(3,"label",73),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"nb-select",74),e.\u0275\u0275listener("selectedChange",function(r){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(u.onPrimarioChange(r))})("ngModelChange",function(r){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(u.selectedPrimarioOtro=r)}),e.\u0275\u0275template(6,o,2,2,"nb-option",13),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",9)(8,"div",10)(9,"label",75),e.\u0275\u0275text(10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"nb-select",76),e.\u0275\u0275listener("ngModelChange",function(r){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(u.selectedSecundarioOtro=r)}),e.\u0275\u0275template(12,m,2,2,"nb-option",13),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(13,"div",8)(14,"div",17)(15,"button",70),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.createAccess())}),e.\u0275\u0275text(16,"Agregar"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"button",77),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(r.showAccessForm=!1)}),e.\u0275\u0275text(18,"Cancelar"),e.\u0275\u0275elementEnd()()()}if(2&a){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(t.primario),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngModel",t.selectedPrimarioOtro),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.primarioList),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(t.secundario),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngModel",t.selectedSecundarioOtro),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.secundarioList)}}function F(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"nb-list-item",80)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",81),e.\u0275\u0275listener("click",function(){const u=e.\u0275\u0275restoreView(t).$implicit,x=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(x.onDeleteAccess(u.id_secundario_otros))}),e.\u0275\u0275element(4,"i",82),e.\u0275\u0275elementEnd()()}if(2&a){const t=h.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("",t.nombre_primario,", ",t.nombre_secundario,"")}}function j(a,h){if(1&a&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"nb-list",78),e.\u0275\u0275template(2,F,5,2,"nb-list-item",79),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&a){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.accessList)}}function z(a,h){if(1&a){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"nb-tab",67)(1,"div",68)(2,"div",69)(3,"h5"),e.\u0275\u0275text(4,"Accesos autorizados"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",70),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(r.showAccessForm=!0)}),e.\u0275\u0275text(6," Nuevo "),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(7,p,19,6,"ng-template",null,71,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(9,j,3,1,"ng-container",72),e.\u0275\u0275elementEnd()()}if(2&a){const t=e.\u0275\u0275reference(8),s=e.\u0275\u0275nextContext();e.\u0275\u0275advance(9),e.\u0275\u0275property("ngIf",!s.showAccessForm)("ngIfElse",t)}}let D=(()=>{class a{constructor(t,s,r,u,x,I,N,H,K){this._formBuilder=t,this._placeService=s,this._residentService=r,this._additionalAccessService=u,this._toastrService=x,this._dialogRef=I,this._dialogService=N,this._menuService=H,this._cdRef=K,this.needApproval=!1,this.onlyPermissions=!1,this.editMode=!1,this.isLoading=!1,this.primarioList=[],this.secundarioList=[],this.accessList=[],this.permissionList=[],this.selectedPermissions=[],this.dominio=!1,this.showAccessForm=!1,this.isAccessTabActive=!1,this.storageUrl=f.N.storageUrl+"/Residentes",this.showImageForm=!1,this.initResidentForm(),this.initResidenceForm(),this.initPictureForm();const G=this._placeService.place$;this.dominio=!!G.dominio,this.isAccessTabActive=this._menuService.isActive(G,S.t.accesos)}ngOnInit(){this.getResident(this.resident.id_residente),this.getPrimario(),this.getSecundario(this.resident.id_primario),this.selectedPrimario=this.resident.id_primario,this.residentForm.patchValue(this.resident),this.residenceForm.patchValue({id_secundario:this.resident.id_secundario,descripcion:this.resident.descripcion}),this.getPermissions(),this.getAccess()}initResidentForm(){this.residentForm=this._formBuilder.group({id_residente:["",l.kI.required],nombres:["",l.kI.required],apellidos:["",l.kI.required],correo:["",l.kI.required],cedula:["",l.kI.required],celular:["",l.kI.required],sexo:["",l.kI.required],fecha_nacimiento:["",l.kI.required],nacionalidad:["",l.kI.required],usuario_modificacion:["admin",l.kI.required]})}initResidenceForm(){this.residenceForm=this._formBuilder.group({id_secundario:["",l.kI.required],descripcion:["",l.kI.required],correo:[""],usuario_modificacion:["admin",l.kI.required]})}initPictureForm(){this.pictureForm=this._formBuilder.group({imagen:["",l.kI.required],id_residente:["",l.kI.required]})}getResident(t){this._residentService.getResidente({id_residente:t}).subscribe({next:r=>{this.selectedResidentPicture=r.foto?`${this.storageUrl}/${r.foto}?timestamp${(new Date).getTime()}`:null,this.pictureForm.patchValue({id_residente:r.id_residente}),this.residenceForm.patchValue(r),this.residentForm.patchValue({sexo:r.sexo,nacionalidad:r.nacionalidad,fecha_nacimiento:r.fecha_nacimiento}),r.fecha_nacimiento&&(this.birthDate=this.getDate(r.fecha_nacimiento))},error:()=>{this.showToast("danger","Ha ocurrido un error al cargar el residente")}})}getDate(t){const s=t.split("-"),r=parseInt(s[0]),u=parseInt(s[1]),x=parseInt(s[2]);return new Date(r,u-1,x)}onDateChanged(t){this.residentForm.patchValue({fecha_nacimiento:t.toISOString().substring(0,10)})}getPrimario(){this._placeService.getPrimarios({id_usuario:1,id_lugar:this.resident.id_lugar}).subscribe({next:s=>{this.primarioList=s}})}getSecundario(t){this._placeService.getSecundarios({id_usuario:1,id_primario:t}).subscribe({next:r=>{this.secundarioList=r}})}onPrimarioChange(t){this.residenceForm.patchValue({id_secundario:null}),this.getSecundario(t)}updateResident(){this._residentService.updateResidente(this.residentForm.value).subscribe({next:()=>{this.showToast("success","Residente actualizado")},error:()=>{this.showToast("danger","Error al actualizar")}})}updateResidentPlace(){const{correo:t,...s}=this.residenceForm.value,r={id_residente_lugar:this.resident.id_residente_lugar,id_residente:this.resident.id_residente,...s};this.dominio&&(r.correo=t),this._residentService.updateResidenteLugar(r).subscribe({next:()=>{this.showToast("success","Residencia actualizada")},error:()=>{this.showToast("danger","Error al actualizar")}})}getPermissions(){this.isLoading=!0,this._residentService.getPermissions({id_residente_lugar:this.resident.id_residente_lugar,id_lugar:this.resident.id_lugar}).subscribe({next:s=>{this.permissionList=s,this.permissionList.map(r=>{"A"==r.estado&&(this.selectedPermissions.push(r.id_permiso),r.dependientes?.map(u=>{"A"==u.estado&&this.selectedPermissions.push(u.id_permiso)}))}),this.isLoading=!1}})}addOrRemovePermission(t,s,r){const u=t?"A":"I";this.permissionList=this.permissionList.map(x=>(x.id_permiso==s&&(r?(t?this.selectedPermissions.push(r):this.selectedPermissions=this.selectedPermissions.filter(I=>I!=r),x.dependientes=x.dependientes.map(I=>(I.id_permiso==r&&(I.estado=u),I))):(t?this.selectedPermissions.push(s):(this.selectedPermissions=this.selectedPermissions.filter(I=>I!=x.id_permiso),x.dependientes=x.dependientes.map(I=>(this.selectedPermissions=this.selectedPermissions.filter(N=>N!=I.id_permiso),I.estado=u,I))),x.estado=u)),x))}updatePermissions(){const t={id_residente_lugar:this.resident.id_residente_lugar,lista:this.selectedPermissions.sort((s,r)=>s-r),usuario_modificacion:"admin"};this._residentService.updatePermissions(t).subscribe({next:()=>{this.needApproval?this._dialogRef.close(!0):this.showToast("success","Permisos actualizados")},error:()=>{this.showToast("danger","Error al actualizar")}})}getAccess(){this._additionalAccessService.getByResidentPlaceId({id_residente_lugar:this.resident.id_residente_lugar}).subscribe({next:s=>{this.accessList=s}})}approve(){this._dialogRef.close(!0)}createAccess(){this._additionalAccessService.create({id_residente_lugar:this.resident.id_residente_lugar,id_secundario:this.selectedSecundarioOtro,usuario_creacion:"admin"}).subscribe({next:s=>{this.accessList.push(s),this.showAccessForm=!1,this.showToast("success","Acceso autorizado")},error:s=>{this.showToast("danger",s.error.causa)}})}onDeleteAccess(t){this._dialogService.open(v.S,{context:{title:"\xbfEst\xe1 seguro de borrar el registro?"}}).onClose.subscribe({next:s=>{s&&this.deleteAccess(t)}})}deleteAccess(t){this._additionalAccessService.delete({id_secundario_otros:t,usuario_modificacion:"admin"}).subscribe({next:r=>{this.accessList=this.accessList.filter(u=>u.id_secundario_otros!=t),this.showToast("success","Registro eliminado")},error:r=>{this.showToast("danger",r.error.causa)}})}loadFile(t){if(!t.length)return;const s=t[0],r=new FileReader;r.onload=()=>{this.pictureForm.patchValue({imagen:s}),this.picture=r.result,this._cdRef.detectChanges()},r.readAsDataURL(s)}uploadImage(){const t=new FormData;t.append("imagen",this.pictureForm.value.imagen),t.append("id_residente",this.pictureForm.value.id_residente),this._residentService.updatePicture(t).subscribe({next:s=>{this.showToast("success","Imagen actualizada"),this.showImageForm=!1,this.selectedResidentPicture=`${this.storageUrl}/${s.imagen}`,this.picture=null,this._cdRef.detectChanges()},error:s=>{this.showToast("danger","Error al subir la imagen")}})}showToast(t,s){this._toastrService.show("",s,{status:t,destroyByClick:!0,duration:3e3,hasIcon:!1,position:c.fe3.TOP_RIGHT,preventDuplicates:!0})}}return a.\u0275fac=function(t){return new(t||a)(e.\u0275\u0275directiveInject(l.qu),e.\u0275\u0275directiveInject(y.k),e.\u0275\u0275directiveInject(w.B),e.\u0275\u0275directiveInject(k),e.\u0275\u0275directiveInject(c.quB),e.\u0275\u0275directiveInject(c.X4l),e.\u0275\u0275directiveInject(c.Gln),e.\u0275\u0275directiveInject(V.h),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))},a.\u0275cmp=e.\u0275\u0275defineComponent({type:a,selectors:[["ngx-resident-form"]],inputs:{resident:"resident",primario:"primario",secundario:"secundario",needApproval:"needApproval"},decls:47,vars:16,consts:[[1,"row","detail-container"],[1,"col-lg-12"],[1,"w-100","d-flex","justify-content-between"],[4,"ngIf"],["fullWidth",""],["tabTitle","Informaci\xf3n"],["tabTitle","Residencia"],[1,"mt-2",3,"formGroup"],[1,"row"],[1,"col-md-6"],[1,"form-group"],["for","inputPrimario",1,"label"],["fullWidth","","id","inputPrimario",3,"ngModel","ngModelOptions","selectedChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","inputSecundario",1,"label"],["fullWidth","","id","inputSecundario","formControlName","id_secundario","placeholder","Seleccionar una opci\xf3n"],["class","row",4,"ngIf"],[1,"col-md-12"],["for","inputDescripcion",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","descripcion"],["nbButton","","status","info","hero","",3,"click"],["tabTitle","Permisos",3,"nbSpinner"],[4,"ngFor","ngForOf"],[1,"row","pt-1"],[1,"col-12"],["tabTitle","Accesos",4,"ngIf"],[1,"d-flex"],["nbButton","","hero","","status","success",3,"click"],[1,"material-symbols-outlined"],[1,"col-md-4","d-flex","flex-column"],[1,"picture-container"],["width","100","height","auto","alt","",3,"src",4,"ngIf"],[3,"click"],["icon","edit"],[1,"col-md-8"],[1,"detail","py-1"],[1,"col-md-12","pt-2"],["width","100","height","auto","alt","",3,"src"],["for","inputNombres",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","nombres"],["for","inputApellidos",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","apellidos"],["for","inputCedula",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","cedula"],["for","inputCorreo",1,"label"],["nbInput","","fullWidth","","type","email","formControlName","correo"],["for","inputSexo",1,"label"],["fullWidth","","name","inputSexo","status","primary","formControlName","sexo",1,"w-100"],["selected","","disabled",""],["value","FEMENINO"],["value","MASCULINO"],["for","inputFechaNacimiento",1,"label"],["nbInput","","fullWidth","",3,"ngModel","ngModelOptions","nbDatepicker","ngModelChange"],[3,"dateChange"],["datepicker",""],["for","inputNacionalidad",1,"label"],["nbInput","","fullWidth","","type","text","formControlName","nacionalidad"],["nbButton","","status","danger","hero","",1,"mr-2",3,"click"],[1,"col-md-2"],["id","inputPicture","type","file","fullWidth","",1,"pl-2",3,"change"],["fileControl",""],[3,"value"],["nbInput","","fullWidth","","type","text","formControlName","correo"],[1,"col-6","py-1"],[3,"checked","checkedChange"],["class","col-6 py-1",4,"ngFor","ngForOf"],[3,"checked","disabled","checkedChange"],["tabTitle","Accesos"],[1,"row","pt-4"],[1,"d-flex","justify-content-between","w-100"],["nbButton","","status","info",3,"click"],["accessForm",""],[4,"ngIf","ngIfElse"],["for","inputPrimarioOtro",1,"label"],["fullWidth","","id","inputPrimarioOtro","placeholder","Seleccionar una opci\xf3n",3,"ngModel","selectedChange","ngModelChange"],["for","inputSecundarioOtro",1,"label"],["fullWidth","","id","inputSecundarioOtro","placeholder","Seleccionar una opci\xf3n",3,"ngModel","ngModelChange"],["nbButton","","ghost","",3,"click"],[1,"d-flex","flex-column","w-100","pt-4",2,"max-height","450px","overflow-y","auto"],["class","d-flex justify-content-between align-items-center",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","align-items-center"],["nbButton","","ghost","","size","large",1,"delete-button",3,"click"],[1,"nb-trash"]],template:function(t,s){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"nb-card")(3,"nb-card-header",2)(4,"h5"),e.\u0275\u0275text(5,"Editar Residente"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,A,6,0,"ng-container",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"nb-card-body")(8,"nb-tabset",4)(9,"nb-tab",5),e.\u0275\u0275template(10,_,39,8,"ng-container",3),e.\u0275\u0275template(11,b,52,5,"ng-container",3),e.\u0275\u0275template(12,T,16,2,"ng-container",3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"nb-tab",6)(14,"form",7)(15,"div",8)(16,"div",9)(17,"div",10)(18,"label",11),e.\u0275\u0275text(19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"nb-select",12),e.\u0275\u0275listener("selectedChange",function(u){return s.onPrimarioChange(u)})("ngModelChange",function(u){return s.selectedPrimario=u}),e.\u0275\u0275template(21,B,2,2,"nb-option",13),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(22,"div",9)(23,"div",10)(24,"label",14),e.\u0275\u0275text(25),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(26,"nb-select",15),e.\u0275\u0275template(27,U,2,2,"nb-option",13),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275template(28,$,6,0,"div",16),e.\u0275\u0275elementStart(29,"div",8)(30,"div",17)(31,"div",10)(32,"label",18),e.\u0275\u0275text(33,"Descripci\xf3n"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(34,"textarea",19),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(35,"div",8)(36,"div",17)(37,"button",20),e.\u0275\u0275listener("click",function(){return s.updateResidentPlace()}),e.\u0275\u0275text(38,"Actualizar"),e.\u0275\u0275elementEnd()()()()(),e.\u0275\u0275elementStart(39,"nb-tab",21)(40,"div",8),e.\u0275\u0275template(41,n,2,1,"ng-container",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(42,"div",23)(43,"div",24)(44,"button",20),e.\u0275\u0275listener("click",function(){return s.updatePermissions()}),e.\u0275\u0275text(45,"Actualizar"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275template(46,z,10,2,"nb-tab",25),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",s.needApproval),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!s.editMode&&!s.showImageForm),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",s.editMode),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",s.showImageForm),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",s.residenceForm),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(s.primario),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngModel",s.selectedPrimario)("ngModelOptions",e.\u0275\u0275pureFunction0(15,R)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",s.primarioList),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(s.secundario),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",s.secundarioList),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",s.dominio),e.\u0275\u0275advance(11),e.\u0275\u0275property("nbSpinner",s.isLoading),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",s.permissionList),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",s.isAccessTabActive))},dependencies:[P.sg,P.O5,l._Y,l.Fj,l.JJ,l.JL,l.On,l.sg,l.u,c.Asz,c.yKW,c.ndF,c.h8i,c.DPz,c.rs,c.q51,c.fMN,c.kyn,c.TR4,c.NTf,c.Q7R,c.$kf,c.B4C],styles:[".detail-container[_ngcontent-%COMP%]{width:700px}.delete-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px}.picture-container[_ngcontent-%COMP%]{position:relative;max-width:100px;height:100px;display:flex;align-items:center;justify-content:center}.picture-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{border-radius:50%;box-shadow:1px 2px 5px -2px #969696;width:100px;height:100px;overflow:hidden;display:flex;align-items:center;justify-content:center}.picture-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer;position:absolute;bottom:-5px;right:-5px;border-radius:50%;padding:3px;color:#fff;background-color:#0496ff;box-shadow:0 1px 5px -2px #969696}"]}),a})()},88542:(O,E,d)=>{d.d(E,{o:()=>W});var l=d(15861),c=d(74385),v=d(36517),S=d(42658),f=d(36749),e=d(56227),y=d(68360),w=d(80574),i=d(30551),k=d(12013);let V=(()=>{class g{constructor(n){this._notificationService=n,this.settings={actions:{position:"right",add:!1,edit:!1,delete:!1,custom:[]},columns:{nombre:{title:"T\xedtulo",type:"string",filter:!0},descripcion:{title:"Descripci\xf3n",type:"string",filter:!0},fecha_creacion:{title:"Fecha",type:"string",filter:!0},tipo:{title:"Tipo",type:"string",filter:!0}}},this.notificationsList=[],this.source=new c.nC}ngOnInit(){this.getNotifications(this.residentId,this.placeId)}getNotifications(n,o){this._notificationService.getByResident({id_residente:n,id_lugar:o}).subscribe({next:p=>{this.source.load(p)},error:p=>{console.error(p)}})}}return g.\u0275fac=function(n){return new(n||g)(i.\u0275\u0275directiveInject(k.g))},g.\u0275cmp=i.\u0275\u0275defineComponent({type:g,selectors:[["ngx-notifications-list"]],inputs:{residentId:"residentId",placeId:"placeId"},decls:6,vars:2,consts:[[1,"w-100","d-flex","justify-content-between"],[1,"custom-table",3,"settings","source"]],template:function(n,o){1&n&&(i.\u0275\u0275elementStart(0,"nb-card")(1,"nb-card-header",0)(2,"h5"),i.\u0275\u0275text(3,"Notificaciones"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(4,"nb-card-body"),i.\u0275\u0275element(5,"ng2-smart-table",1),i.\u0275\u0275elementEnd()()),2&n&&(i.\u0275\u0275advance(5),i.\u0275\u0275property("settings",o.settings)("source",o.source))},dependencies:[v.Asz,v.yKW,v.ndF,c.T5]}),g})(),P=(()=>{class g{constructor(){}ngOnInit(){this.hasValue=!!this.value}}return g.\u0275fac=function(n){return new(n||g)},g.\u0275cmp=i.\u0275\u0275defineComponent({type:g,selectors:[["ngx-check-value"]],inputs:{value:"value",rowData:"rowData"},decls:1,vars:1,template:function(n,o){1&n&&i.\u0275\u0275text(0),2&n&&i.\u0275\u0275textInterpolate(o.hasValue?"S\xed":"No")},encapsulation:2}),g})();var A=d(7672),M=d(18328),L=d(12368),_=d(36895),R=d(94176);const b=["stepper"],T=["password"];function B(g,C){if(1&g&&(i.\u0275\u0275elementStart(0,"nb-option",14),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),2&g){const n=C.$implicit,o=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("value",n),i.\u0275\u0275advance(1),i.\u0275\u0275textInterpolate1(" ",o.statusList[n]," ")}}function U(g,C){if(1&g){const n=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"nb-select",12),i.\u0275\u0275listener("selectedChange",function(m){i.\u0275\u0275restoreView(n);const p=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(p.getResidents(p.placeId,m))}),i.\u0275\u0275template(2,B,2,2,"nb-option",13),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()}if(2&g){const n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(1),i.\u0275\u0275property("selected",n.selectedStatus),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngForOf",n.status)}}function $(g,C){if(1&g&&(i.\u0275\u0275elementStart(0,"div",15)(1,"h6"),i.\u0275\u0275text(2,"Clave temporal del usuario"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"p",16),i.\u0275\u0275text(4),i.\u0275\u0275elementEnd()()),2&g){const n=C.$implicit;i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate(n)}}let W=(()=>{class g{constructor(n,o,m,p,F,j){this._router=n,this._activatedRoute=o,this._dialogService=m,this._toastrService=p,this._residentService=F,this._placeService=j,this.status=["T"],this.primario="Primario",this.secundario="Secundario",this.statusList={T:"Todos",A:"Activo",P:"Pendiente",I:"Inactivo",R:"Rechazado",E:"Eliminado"},this.customActions={notifications:{name:"notifications",title:'<i class="nb-icon far fa-bell"></i>'},approve:{name:"approve",title:'<i class="nb-checkmark" title="Aprobar"></i>'},decline:{name:"decline",title:'<i class="nb-close" title="Rechazar"></i>'},edit:{name:"edit",title:'<i class="nb-edit"></i>'},delete:{name:"delete",title:'<i class="nb-trash"></i>'},resetPassword:{name:"resetPassword",title:'<img src="./assets/images/key-outline.svg" title="Restablecer contrase\xf1a">'},logout:{name:"logout",title:'<img src="./assets/images/log-out-outline.svg" title="Cerrar sesi\xf3n">'},verify:{name:"verify",title:'<img src="./assets/images/person-done-outline.svg" title="Verificar">'},sendVerificationEmail:{name:"sendVerificationEmail",title:'<i class="nb-email" title="Enviar correo de verificaci\xf3n"></i>'},updatePlace:{name:"updatePlace",title:'<i class="nb-home" title="Solicitar actualizaci\xf3n de lugar"></i>'},updateInfo:{name:"updateInfo",title:'<i class="nb-list" title="Solicitar actualizaci\xf3n de informaci\xf3n"></i>'},accessReport:{name:"accessReport",title:'<img src="./assets/images/checklist.svg" title="Reporte de ingreso">'}},this.settings={actions:{position:"right",add:!1,edit:!1,delete:!1,custom:[]},columns:{nombres:{title:"Nombres",type:"string",filter:!0},apellidos:{title:"Apellidos",type:"string",filter:!0},cedula:{title:"Cedula",type:"string",filter:!0},correo:{title:"Correo",type:"string",filter:!0},celular:{title:"Celular",type:"string",filter:!0},nombre_primario:{title:this.primario,type:"string",filter:!0},nombre_secundario:{title:this.secundario,type:"string",filter:!0},descripcion:{title:"Descripci\xf3n",type:"string",filter:!0},foto:{title:"Tiene foto",type:"custom",filter:!0,renderComponent:P}}},this.residentsList=[],this.source=new c.nC;const z=this._activatedRoute.parent.snapshot.paramMap.get("placeId");z&&(this.placeId=parseInt(z));const D=this._activatedRoute.snapshot.data.status;D&&(this.status=D)}ngOnInit(){this._placeService.getPlace({id_lugar:this.placeId}).subscribe(n=>{this.primario=n.primario,this.secundario=n.secundario}),this.selectedStatus=this.status[0],this.getResidents(this.placeId,this.selectedStatus),this.setActions()}setActions(){var n=this;switch(this.settings.actions.custom=[],this.selectedStatus){case"P":this.settings.actions.custom.push(this.customActions.approve),this.settings.actions.custom.push(this.customActions.decline);break;case"A":this.settings.actions.custom.push(this.customActions.notifications,this.customActions.accessReport,this.customActions.updatePlace,this.customActions.updateInfo,this.customActions.logout,this.customActions.resetPassword,this.customActions.edit,this.customActions.delete),this.settings.columns.estado={title:"Estado",type:"custom",renderComponent:f.P,onComponentInitFunction:o=>{o.toggle.subscribe(function(){var m=(0,l.Z)(function*(p){const F=p.value?"A":"I";yield n.updateStatus(p.row.id_residente_lugar,F),n.getResidents(n.placeId,n.selectedStatus)});return function(p){return m.apply(this,arguments)}}())},filter:!1};break;case"I":case"R":case"E":this.settings.actions.custom.push(this.customActions.approve),this.settings.actions.custom.push(this.customActions.delete)}}getResidents(n,o){this.selectedStatus=o,this.secundarioId?this._residentService.getBySecundario({id_secundario:this.secundarioId}).subscribe({next:m=>{this.residentsList=m,this.source.load(m)},error:m=>{console.error(m)}}):this._residentService.getByPlace({id_lugar:n,estado:o}).subscribe({next:p=>{this.residentsList=p,this.source.load(p)},error:p=>{console.error(p)}})}onCustom(n){switch(n.action){case"edit":this._dialogService.open(e.P,{context:{resident:n.data,primario:this.primario,secundario:this.secundario}}).onClose.subscribe(()=>{this.getResidents(this.placeId,this.selectedStatus)});break;case"delete":"A"==this.selectedStatus?this.onUpdateStatus(n.data.id_residente_lugar,"E"):this.onDelete(n.data.id_residente_lugar);break;case"notifications":this.onShowNotifications(n.data.id_residente);break;case"approve":this.onApprove(n.data,"A");break;case"decline":this.onUpdateStatus(n.data.id_residente_lugar,"R");break;case"resetPassword":this.onResetPassword(n.data.id_residente);break;case"logout":this.onResidentLogout(n.data.id_residente);break;case"verify":this.onVerify(n.data.id_residente);break;case"sendVerificationEmail":this.onSendVerificationEmail(n.data.id_residente);break;case"updatePlace":this.onUpdatePlace(n.data.id_residente_lugar);break;case"updateInfo":this.onUpdateInfo(n.data.id_residente);break;case"accessReport":this.stepperComponent.next(),this.selectedResidentId=n.data.id_residente,this.selectedResidentPlaceId=n.data.id_residente_lugar}}add(){this._router.navigate(["/pages/residentes/crear"])}onDelete(n){this._dialogService.open(S.S,{context:{title:"\xbfEst\xe1 seguro de eliminar el registro?"}}).onClose.subscribe({next:o=>{o&&this.deleteResident(n)}})}deleteResident(n){this._residentService.delete({id_residente_lugar:n,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Residente eliminado"),this.getResidents(this.placeId,this.selectedStatus)},error:()=>{this.showToast("danger","Error al eliminar el residente")}})}onShowNotifications(n){this._dialogService.open(V,{context:{residentId:n,placeId:this.placeId}})}onApprove(n,o){var m=this;this._dialogService.open(e.P,{context:{resident:n,primario:this.primario,secundario:this.secundario,needApproval:!0}}).onClose.subscribe(function(){var p=(0,l.Z)(function*(F){F&&(yield m.updateStatus(n.id_residente_lugar,o),m.getResidents(m.placeId,m.selectedStatus))});return function(F){return p.apply(this,arguments)}}())}onUpdateStatus(n,o){var p,m=this;this._dialogService.open(S.S,{context:{title:"\xbfEst\xe1 seguro de actualizar el estado del registro?"}}).onClose.subscribe({next:(p=(0,l.Z)(function*(F){F&&(yield m.updateStatus(n,o),m.getResidents(m.placeId,m.selectedStatus))}),function(j){return p.apply(this,arguments)})})}updateStatus(n,o){return new Promise(m=>{this._residentService.updateStatus({id_residente_lugar:n,estado:o,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Estado actualizado")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")},complete:()=>{setTimeout(()=>{m()},0)}})})}onResetPassword(n){this._dialogService.open(S.S,{context:{title:"\xbfEst\xe1 seguro de restablecer la contrase\xf1a del residente?"}}).onClose.subscribe({next:o=>{o&&this.resetPassword(n)}})}resetPassword(n){this._residentService.resetPassword({id_residente:n,usuario_modificacion:"admin"}).subscribe({next:m=>{this._dialogService.open(this.dialog,{context:m.clave})},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onResidentLogout(n){this._dialogService.open(S.S,{context:{title:"\xbfEst\xe1 seguro de cerrar la sesi\xf3n del residente?"}}).onClose.subscribe({next:o=>{o&&this.residentLogout(n)}})}residentLogout(n){this._residentService.residentLogout({id_residente:n,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Sesi\xf3n finalizada")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onVerify(n){this._dialogService.open(S.S,{context:{title:"\xbfEst\xe1 seguro de verificar la cuenta del residente?"}}).onClose.subscribe({next:o=>{o&&this.verify(n)}})}verify(n){this._residentService.verify({id_residente:n,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Cuenta verificada")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onSendVerificationEmail(n){this._dialogService.open(S.S,{context:{title:"\xbfEst\xe1 seguro de enviar el correo de verificaci\xf3n al residente?"}}).onClose.subscribe({next:o=>{o&&this.sendVerificationEmail(n)}})}sendVerificationEmail(n){this._residentService.sendVerificationEmail({id_residente:n,usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Correo enviado")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onUpdatePlace(n){this._dialogService.open(S.S,{context:{title:"\xbfEst\xe1 seguro de solicitar la actualizaci\xf3n de lugar?"}}).onClose.subscribe({next:o=>{o&&this.updatePlace(n)}})}updatePlace(n){this._residentService.updatePlace({id_residente_lugar:n,estado:"S",usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Solicitud establecida")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}onUpdateInfo(n){this._dialogService.open(S.S,{context:{title:"\xbfEst\xe1 seguro de solicitar la actualizaci\xf3n de informaci\xf3n?"}}).onClose.subscribe({next:o=>{o&&this.updateInfo(n)}})}updateInfo(n){this._residentService.updateInfo({id_residente:n,estado:"P",usuario_modificacion:"admin"}).subscribe({next:()=>{this.showToast("success","Solicitud establecida")},error:()=>{this.showToast("danger","Ha ocurrido un error. Intente nuevamente")}})}showToast(n,o){this._toastrService.show("",o,{status:n,destroyByClick:!0,duration:3e3,hasIcon:!1,position:v.fe3.TOP_RIGHT,preventDuplicates:!0})}getTable(){return new Promise(n=>{const o=[];this.residentsList.forEach(m=>{let p=new y.oB(m);o.push(p)}),setTimeout(()=>{n(o)},0)})}downloadReport(){var n=this;return(0,l.Z)(function*(){const o=yield n.getTable(),m=w.P6.json_to_sheet(o),p=w.P6.book_new();w.P6.book_append_sheet(p,m,"SheetName"),w.NC(p,"residentes.xlsx")})()}}return g.\u0275fac=function(n){return new(n||g)(i.\u0275\u0275directiveInject(A.F0),i.\u0275\u0275directiveInject(A.gz),i.\u0275\u0275directiveInject(v.Gln),i.\u0275\u0275directiveInject(v.quB),i.\u0275\u0275directiveInject(M.B),i.\u0275\u0275directiveInject(L.k))},g.\u0275cmp=i.\u0275\u0275defineComponent({type:g,selectors:[["ngx-residents-list"]],viewQuery:function(n,o){if(1&n&&(i.\u0275\u0275viewQuery(b,5),i.\u0275\u0275viewQuery(T,5)),2&n){let m;i.\u0275\u0275queryRefresh(m=i.\u0275\u0275loadQuery())&&(o.stepperComponent=m.first),i.\u0275\u0275queryRefresh(m=i.\u0275\u0275loadQuery())&&(o.dialog=m.first)}},inputs:{placeId:"placeId",secundarioId:"secundarioId",status:"status",primario:"primario",secundario:"secundario"},decls:19,vars:7,consts:[["orientation","horizontal",3,"disableStepNavigation"],["stepper",""],["label","Residentes"],[1,"w-100","d-flex","justify-content-between"],[1,"d-flex"],[4,"ngIf"],["nbButton","","hero","","status","success",3,"disabled","click"],[1,"material-symbols-outlined"],[1,"custom-table",3,"settings","source","custom"],["label","Ingresos"],[3,"residentId","residentPlaceId","back"],["password",""],["status","basic",1,"pr-4",3,"selected","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"password-container"],[1,"text-center","pt-3"]],template:function(n,o){1&n&&(i.\u0275\u0275elementStart(0,"nb-stepper",0,1)(2,"nb-step",2)(3,"nb-card")(4,"nb-card-header",3)(5,"h5"),i.\u0275\u0275text(6,"Residentes"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(7,"div",4),i.\u0275\u0275template(8,U,3,2,"ng-container",5),i.\u0275\u0275elementStart(9,"button",6),i.\u0275\u0275listener("click",function(){return o.downloadReport()}),i.\u0275\u0275elementStart(10,"span",7),i.\u0275\u0275text(11,"download"),i.\u0275\u0275elementEnd(),i.\u0275\u0275text(12," Descargar "),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275elementStart(13,"nb-card-body")(14,"ng2-smart-table",8),i.\u0275\u0275listener("custom",function(p){return o.onCustom(p)}),i.\u0275\u0275elementEnd()()()(),i.\u0275\u0275elementStart(15,"nb-step",9)(16,"ngx-access-report-table",10),i.\u0275\u0275listener("back",function(){return o.stepperComponent.previous()}),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275template(17,$,5,1,"ng-template",null,11,i.\u0275\u0275templateRefExtractor)),2&n&&(i.\u0275\u0275property("disableStepNavigation",!0),i.\u0275\u0275advance(8),i.\u0275\u0275property("ngIf",o.status.length>1),i.\u0275\u0275advance(1),i.\u0275\u0275property("disabled",!o.residentsList||0===o.residentsList.length),i.\u0275\u0275advance(5),i.\u0275\u0275property("settings",o.settings)("source",o.source),i.\u0275\u0275advance(2),i.\u0275\u0275property("residentId",o.selectedResidentId)("residentPlaceId",o.selectedResidentPlaceId))},dependencies:[_.sg,_.O5,v.Asz,v.yKW,v.ndF,c.T5,v.DPz,v.rs,v.q51,v.TLo,v.Sv4,R.y],styles:["[_nghost-%COMP%]     nb-stepper .header{display:none}[_nghost-%COMP%]     [nbButton].appearance-ghost.status-basic:hover, .appearance-ghost.status-basic[nbButtonToggle][_ngcontent-%COMP%]:hover{background-color:transparent}[_nghost-%COMP%]     nb-stepper .step-content{padding:0}[_nghost-%COMP%]     tr .ng2-smart-actions{height:auto}[_nghost-%COMP%]     ng2-st-tbody-custom{display:flex;align-items:center}[_nghost-%COMP%]     ng2-st-tbody-custom a.ng2-smart-action.ng2-smart-action-custom-custom{display:flex;align-items:center;text-align:center}[_nghost-%COMP%]     ng2-st-tbody-custom a.ng2-smart-action.ng2-smart-action-custom-custom img{width:22px;filter:contrast(.3)}.password-container[_ngcontent-%COMP%]{padding:20px;background-color:#fff}"]}),g})()},39263:(O,E,d)=>{d.r(E),d.d(E,{ResidentsModule:()=>L});var l=d(36517),c=d(74385),v=d(7672),S=d(56227),f=d(30551);let e=(()=>{class _{constructor(){}}return _.\u0275fac=function(b){return new(b||_)},_.\u0275cmp=f.\u0275\u0275defineComponent({type:_,selectors:[["ngx-residents"]],decls:1,vars:0,template:function(b,T){1&b&&f.\u0275\u0275element(0,"router-outlet")},dependencies:[v.lC],encapsulation:2}),_})();var y=d(20732),w=d(88542);const k=[{path:"",component:e,children:[{path:"",component:(()=>{class _{constructor(b){this._activatedRoute=b;const T=this._activatedRoute.parent.parent.parent.snapshot.paramMap.get("placeId");T&&(this.placeId=parseInt(T)),this.status=this._activatedRoute.snapshot.data.status}}return _.\u0275fac=function(b){return new(b||_)(f.\u0275\u0275directiveInject(v.gz))},_.\u0275cmp=f.\u0275\u0275defineComponent({type:_,selectors:[["ngx-index"]],decls:2,vars:2,consts:[[3,"placeId","status"]],template:function(b,T){1&b&&(f.\u0275\u0275elementStart(0,"ngx-no-padding-layout"),f.\u0275\u0275element(1,"ngx-residents-list",0),f.\u0275\u0275elementEnd()),2&b&&(f.\u0275\u0275advance(1),f.\u0275\u0275property("placeId",T.placeId)("status",T.status))},dependencies:[y.F,w.o]}),_})()},{path:"crear",component:S.P},{path:"editar",component:S.P}]}];let V=(()=>{class _{}return _.\u0275fac=function(b){return new(b||_)},_.\u0275mod=f.\u0275\u0275defineNgModule({type:_}),_.\u0275inj=f.\u0275\u0275defineInjector({imports:[v.Bz.forChild(k),v.Bz]}),_})();var P=d(24006),A=d(97137),M=d(78253);let L=(()=>{class _{}return _.\u0275fac=function(b){return new(b||_)},_.\u0275mod=f.\u0275\u0275defineNgModule({type:_}),_.\u0275inj=f.\u0275\u0275defineInjector({imports:[A.O,P.u5,P.UX,V,l.zyh,c.ne,l.nKr,l.T2N,l.IIj,l.KdK,l.EoG,l.MfT,l.uuI,l.OA,l.obu,M.AccessReportModule]}),_})()},12013:(O,E,d)=>{d.d(E,{g:()=>S});var l=d(92340),c=d(80529),v=d(30551);let S=(()=>{class f{constructor(y){this.http=y,this.apiUrl=l.N.apiUrl}send(y){const w=`${this.apiUrl}/insertNotificacionGrupal`,i={headers:new c.WM({Authorization:l.N.token})};return this.http.post(w,y,i)}getByResident(y){return this.http.post(`${this.apiUrl}/getAllNotificacion_lugar`,y)}}return f.\u0275fac=function(y){return new(y||f)(v.\u0275\u0275inject(c.eN))},f.\u0275prov=v.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()}}]);